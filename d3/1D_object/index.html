<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>D3 Test</title>
<script type="text/javascript" src="d3/d3.v3.js"></script>
<style>
.box {
fill: #f44;
stroke: black;
stroke-width: 2px;
}

path
{
stroke: red;
stroke-width: 2px;
fill: none;
}

line
{
stroke: black;
stroke-width: 5px;
}

text
{
font-family: Arial;
font-size: 9pt;
}

</style>
</head>
<body>
<script type="text/javascript">
{

    //Drawing The object
    var w = 1000,
	h = 400;
    var svg = d3.select("body")
	.append("svg")
	.attr("width",w)
	.attr("height",h)
	.style("background-color","#66f");

    var dataset = [];
    var radi = h/10;
    var x1 = 100, y1 = h/2-radi;
    var x2 = 10, y2 = 5;
    var diag = svg.append("svg")
		  .attr("width" , w/2)
		  .attr("height", h/2)
		  .attr("y", h/4);
    
    var timeInterval = y1-radi;
    var circles = diag.append("circle");

    circles.attr("cx", x1)
	.attr("cy", y1)
	.attr("r", radi)
	.attr("class", function(d,i){
		return "box";
		}) ;
    
    //animating the object
        //Drawing the plot
    var vis = svg.append("svg")
		 .attr("width", w/2)
		 .attr("height", h/2)
		 .attr("x", w/2)
		 .attr("y", h/4);
    var decor = vis.append("svg:g"),
	graph = vis.append("svg:g"),
	path = graph.append("svg:path"),
        curve = d3.svg.line(),
	time = 0,
	i;

    var temp = y1;
    dataset.push(temp);
	
    var xScale = d3.scale.linear()
			.domain([0,timeInterval])
			.range([0,(w/4)]);
    var yScale = d3.scale.linear()
			.domain([0, h/2-(2*radi)])
			.range([0, h/2]);


    curve.x(function (d,i) {return xScale(0)+time;})
	 .y(function (d,i) {return yScale(0)-temp;});

    // X-Axis
    decor.append('svg:line')
         .attr('class', 'axis')
         .attr('x1', xScale(0))
         .attr('y1', yScale(h/2-(2*radi)))
         .attr('x2', xScale(timeInterval))
         .attr('y2', yScale(h/2-(2*radi)));
    // Y-Axis
    decor.append('svg:line')
         .attr('class', 'axis')
         .attr('x1', xScale(0))
         .attr('y1', yScale(0))
         .attr('x2', xScale(0))
         .attr('y2', yScale(h/2-(2*radi)));


    decor.append("svg:text")
	 .attr('class','y-val')
         .text('y-value :'+temp)
         .attr("x", w/4)
         .attr("y", h/4)
         .attr("text-anchor", "middle");

   decor.append("svg:text")
	 .attr('class','x-val')
         .text('x-value :'+time)
         .attr("x", w/4)
         .attr("y", h/4-20)
         .attr("text-anchor", "middle");


	
function update(){
	
    
/*	var   x = xScale(time),
	      y = yScale(temp);
*/
	if(temp >= radi)
	    temp -= 1;
	else
	    temp = y1;
	
	dataset.push(temp);
	time = (time+1)%timeInterval;
	path.attr('d', curve(dataset));

	decor.selectAll("text").filter('.y-val')
	     .transition()
	     .text('y-value :'+temp);

	decor.selectAll("text").filter('.x-val')
	     .transition()
	     .text('x-value :'+time);


	svg.selectAll("circle")
	    .transition()
	    .attr("cy", function(){
		        return temp;
		});

	 
    }
    

   //Updating the objects y attribute to animate with time
    setInterval(function(){
	    update();
	    }, timeInterval);

         
}

</script>
</body>
</html>     
